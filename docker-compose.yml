version: '3'
services:
 web:
  image: nginx:alpine
  restart: always
  tty: true
  ports:
    - "8080:80"
  volumes:
    - ./code:/code
    - ./site.conf:/etc/nginx/conf.d/default.conf
  links:
    - php
 
 db:
  image: postgres:9.5-alpine
  environment:
   - POSTGRES_USER=root
   - POSTGRES_PASSWORD=toor
   - POSTGRES_DB=blog
  ports:
   - "5432:5432"

 php:
  build:
   context: .
   dockerfile: ./dockers/php/Dockerfile
  volumes:
    - ./code:/code
  env_file:
    - ./code/app/.env
  depends_on:
    - db